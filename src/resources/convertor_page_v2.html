<!DOCTYPE html>
<html style="height: 100%;width: 100%;">

<head>
  <meta charset="UTF-8">
  <title>模型转换器</title>
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body class="dark-mode" style="height: 100%;width: 100%;overflow: hidden;">

    <!-- 按钮触发模态框 -->
<button id="modal_dialog" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" style="display: none;">
	创建新的项目
</button>
<button id="modal_dialog_projrefac" class="btn" data-toggle="modal" data-target="#myModalProjRefact" style="display: none;">
  修改项目属性
</button>

</button>
<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="background-color: white;color: #333;">
	<div class="modal-dialog" style="background-color: white;width: 800px;">
		<div class="modal-content" style="background-color: white;">
			<div>
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="color: rgb(0, 0, 0);margin-right: 30px;">
					&times;
				</button>
				<h4 id="myModalLabel" style="font-family: SourceHanSansCN-Normal;
        font-size: 24px;
        color: #333333;
        letter-spacing: 1.07px;margin-left: 20px;">
					项目创建向导
				</h4>
			</div>
			<div>
        <div id="alert_sheet" class="alert alert-danger" style="display: none;">
          <a href="#" class="close" data-dismiss="alert">
              &times;
          </a>
          <div id="error_band_text">
            <strong>警告！</strong>您的网络连接有问题。
          </div>
        </div>
                <form role="form" id="project_info_form">
                    <div id="proj_name_div" style="margin-top: 50px;">
                        <label for="project_name" id="lb_project_name" style="font-family: SourceHanSansCN-Normal;
                        font-size: 22px;
                        color: #333333;
                        letter-spacing: 1.26px;margin-left: 186px;">项目名称: </label>
                        <input type="text" id="project_name" style="background: #EEEEEE;
                        border: 1px solid #D9D9D9;
                        border-radius: 6px;
                        border-radius: 6px;width: 476px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                    </div>
                    <div style="margin-top: 20px;">
                        <label for="select_type" style="font-family: SourceHanSansCN-Normal;
                        font-size: 22px;
                        color: #333333;
                        letter-spacing: 1.26px;margin-left: 140px;">选择项目类别: </label>
                        <select id="select_type" style="background: #EEEEEE;
                        border: 1px solid #D9D9D9;
                        border-radius: 6px;
                        border-radius: 6px;width: 478px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                            <option>图像分类</option>
                            <option>语音识别</option>
                            <option>目标检测</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                        <label for="python_type" style="font-family: SourceHanSansCN-Normal;
                        font-size: 22px;
                        color: #333333;
                        letter-spacing: 1.26px;margin-left: 100px;">选择python版本: </label>
                        <select id="python_type" style="background: #EEEEEE;
                        border: 1px solid #D9D9D9;
                        border-radius: 6px;
                        border-radius: 6px;width: 478px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                            <option>python3.6x</option>
                            <option>python3.7x</option>
                            <option>python3.8x</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                      <label for="ann_lib_type" style="font-family: SourceHanSansCN-Normal;
                      font-size: 22px;
                      color: #333333;
                      letter-spacing: 1.26px;margin-left: 46px;">模型使用的神经网络库: </label>
                      <select id="ann_lib_type" style="background: #EEEEEE;
                      border: 1px solid #D9D9D9;
                      border-radius: 6px;
                      border-radius: 6px;width: 480px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                        <option>Keras(Tensorflow backended)</option>
                      </select>
                    </div>
                    <div class="input-group" style="background: #EEEEEE;
                    border-radius: 6px;
                    border-radius: 6px;margin-left: 100px;margin-right: 22px;">
                      <span id="span_save_path" class="input-group-addon" style="cursor:pointer;background: #DFDFDF;font-family: SourceHanSansCN-Normal;
                      font-size: 22px;
                      color: #333333;
                      letter-spacing: 1.26px;">点击选择保存路径</span>
                      <input id="proj_save_path_input" type="text" class="form-control" style="background: #EEEEEE;
                      border-radius: 6px;
                      border-radius: 6px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                    </div>
                </form>
			</div>
			<div style="margin-top: 40px;margin-bottom: 40px;">
				<button type="button" class="btn btn-default" data-dismiss="modal" id="dismiss" style="background: #F3F3F3;
        border: 1px solid #D7D7D7;
        border-radius: 2px;
        border-radius: 2px;width: 140px;margin-left: 200px;">关闭
				</button>
				<button type="button" class="btn btn-primary" id="create" style="background-image: linear-gradient(180deg, #AFD1FF 0%, #77A4FF 100%);
        border-radius: 2px;
        border-radius: 2px;width: 140px;margin-left: 60px;">创建
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>

<!--项目属性修改-->
<div class="modal fade" id="myModalProjRefact" tabindex="-1" role="dialog" aria-labelledby="myModalLabelProjRefact" aria-hidden="true" style="background-color: white;color: #333;">
	<div class="modal-dialog" style="background-color: white;width: 800px;">
		<div class="modal-content" style="background-color: white;">
			<div>
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="color: rgb(0, 0, 0);margin-right: 30px;">
					&times;
				</button>
				<h4 id="myModalLabelProjRefact" style="font-family: SourceHanSansCN-Normal;
        font-size: 24px;
        color: #333333;
        letter-spacing: 1.07px;margin-left: 20px;">
					项目属性修改
				</h4>
			</div>
			<div class="modal-body">
                <form role="form" id="project_info_form_projrefac">
                    <div style="margin-top: 50px;">
                        <label for="project_name_projrefac" style="font-family: SourceHanSansCN-Normal;
                        font-size: 22px;
                        color: #333333;
                        letter-spacing: 1.26px;margin-left: 186px;">项目名称</label>
                        <input type="text" id="project_name_projrefac" style="background: #EEEEEE;
                        border: 1px solid #D9D9D9;
                        border-radius: 6px;
                        border-radius: 6px;width: 476px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                    </div>
                    <div style="margin-top: 20px;">
                        <label for="select_type_refac" style="font-family: SourceHanSansCN-Normal;
                        font-size: 22px;
                        color: #333333;
                        letter-spacing: 1.26px;margin-left: 140px;">选择项目类别</label>
                        <select id="select_type_refac" style="background: #EEEEEE;
                        border: 1px solid #D9D9D9;
                        border-radius: 6px;
                        border-radius: 6px;width: 478px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                            <option>图像分类</option>
                            <option>语音识别</option>
                            <option>目标检测</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                        <label for="python_type_projrefac" style="font-family: SourceHanSansCN-Normal;
                        font-size: 22px;
                        color: #333333;
                        letter-spacing: 1.26px;margin-left: 100px;">选择python版本</label>
                        <select id="python_type_projrefac" style="background: #EEEEEE;
                        border: 1px solid #D9D9D9;
                        border-radius: 6px;
                        border-radius: 6px;width: 478px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                            <option>python3.6x</option>
                            <option>python3.7x</option>
                            <option>python3.8x</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                      <label for="ann_lib_type_projrefac" style="font-family: SourceHanSansCN-Normal;
                      font-size: 22px;
                      color: #333333;
                      letter-spacing: 1.26px;margin-left: 46px;">模型使用的神经网络库</label>
                      <select id="ann_lib_type_projrefac" style="background: #EEEEEE;
                      border: 1px solid #D9D9D9;
                      border-radius: 6px;
                      border-radius: 6px;width: 480px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                        <option>Keras(Tensorflow backended)</option>
                      </select>
                    </div>
                </form>
			</div>
			<div style="margin-top: 40px;margin-bottom: 40px;">
				<button type="button" class="btn btn-default" data-dismiss="modal" id="dismiss_projrefac" style="background: #F3F3F3;
        border: 1px solid #D7D7D7;
        border-radius: 2px;
        border-radius: 2px;width: 140px;margin-left: 200px;">取消
				</button>
				<button type="button" class="btn btn-primary" id="create_projrefac" style="background-image: linear-gradient(180deg, #AFD1FF 0%, #77A4FF 100%);
        border-radius: 2px;
        border-radius: 2px;width: 140px;margin-left: 60px;">确认
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>

</body>
<style>

.editor-sidenav{
  background-color: #333;
}

body {
  padding: 25px;
  background-color: rgb(250, 253, 253);
  color: white;
  font-size: 25px;
}

.dark-mode {
  background-color: rgb(250, 253, 253);
  color: white;
}
  @font-face {
    font-family: 'Material Icons';
    font-style: normal;
    font-weight: 400;
    src: local('Material Icons'), local('MaterialIcons-Regular'), url(https://fonts.gstatic.com/s/materialicons/v7/2fcrYFNaTjcS6g4U3t-Y5ZjZjT5FdEJ140U2DJYC3mY.woff2) format('woff2');
  }

  .material-icons {
    font-family: 'Material Icons';
    font-weight: normal;
    font-style: normal;
    font-size: 24px;
    line-height: 1;
    text-transform: none;
    display: inline-block;
    -webkit-font-feature-settings: 'liga';
    -webkit-font-smoothing: antialiased;
  }

  .resizable {
    resize: both;
    overflow: scroll;
    border: 1px solid black;
  }
  .dropdown-content{
   width: max-content !important;
   height:auto !important;
}
</style>

<!-- <link rel="stylesheet" href="http://localhost:6003/css/bootstrap.min.css">
<script src="http://localhost:6003/js/jquery.min.js"></script>
<script src="http://localhost:6003/js/bootstrap.min.js"></script> -->

<script>

    const vscode = acquireVsCodeApi();
    $(document).ready(function(){
       // 选择项目文件保存路径
       $("#span_save_path").on("click", function(){
         // 发送消息到extension，打开选择路径的dialog
         console.log("发送消息到extension，打开选择路径的dialog");
         vscode.postMessage(JSON.stringify({"select_save_proj_path_req":$("#project_name").val()}));
       });

       $("#project_name").on('change',(evt)=>{
        document.getElementById("alert_sheet").style.display = "none";
        document.getElementById("project_name").style.borderColor = '#D9D9D9';
        document.getElementById("lb_project_name").style.color = '#333333';
       });

        $("#create").on("click",function(){
            console.log("创建xxx");
            // 字段检查
            if($("#project_name").val() === undefined || $("#project_name").val().toString().trim().length === 0){
              document.getElementById("alert_sheet").style.display = "block";
              document.getElementById("project_name").style.borderColor='#f82d2d';
              document.getElementById("lb_project_name").style.color = '#f82d2d';
              document.getElementById("error_band_text").innerHTML = '<strong>项目名称不可为空!</strong>';
              return;
            }else if($("#project_name").val().toString().trim().length > 20){
              document.getElementById("alert_sheet").style.display = "block";
              document.getElementById("project_name").style.borderColor='#f82d2d';
              document.getElementById("lb_project_name").style.color = '#f82d2d';
              document.getElementById("error_band_text").innerHTML = '<strong>项目名称不可超过20个字符!</strong>';
              return;
            }else if($("#project_name").val().toString().trim().search("[\~\!\！\@\#\$\￥\%\<\>\》\《\.\?\？]") >=0){
              document.getElementById("alert_sheet").style.display = "block";
              document.getElementById("project_name").style.borderColor='#f82d2d';
              document.getElementById("lb_project_name").style.color = '#f82d2d';
              document.getElementById("error_band_text").innerHTML = '<strong>项目名称不可包含特殊字符!</strong>';
              return;
            }

            if($("#proj_save_path_input").val().toString().trim().length === 0){
              document.getElementById("alert_sheet").style.display = "block";
              document.getElementById("span_save_path").style.color = '#f82d2d';
              document.getElementById("proj_save_path_input").style.borderColor = '#f82d2d';
              document.getElementById("error_band_text").innerHTML = '<strong>项目路径不可为空!</strong>';
              return;
            }

            var project_name = $("#project_name").val();
            var project_type = $("#select_type").val();
            var python_type = $("#python_type").val();
            var ann_lib_type = $("#ann_lib_type").val();
            // 发送到extension
            vscode.postMessage(JSON.stringify({"project_info":{
              "project_name":project_name, "project_type":project_type,
                            "python_type":python_type, "ann_lib_type":ann_lib_type
            }}));
            $("#dismiss").click();
        });
        $("#dismiss").on("click", function(){
            console.log("取消创建");
        });

        $("#create_projrefac").on("click", function(){
          console.log("修改项目属性");
          var proj_name = $("#project_name_projrefac").val();
          var proj_type = $("#select_type_refac").val();
          var python_type = $("#python_type_projrefac").val();
          var ann_lib_type = $("#ann_lib_type_projrefac").val();

          // 发送到extension
          vscode.postMessage(JSON.stringify({"project_refac_info":{
            "project_name":proj_name, "project_type":proj_type, "python_type":python_type,"ann_lib_type":ann_lib_type
          }}));
          $("#dismiss_projrefac").click();
        });

        $("#dismiss_projrefac").on("click", function(){
          console.log("取消修改项目属性");
        });

        // 接收从extension 的消息
        window.addEventListener('message', (event)=>{
            const message = event.data; // JSON data from extension
            if(message.command){
                  console.log("从extension 接收到消息：xxxxxx:"+message.command);
                if(message.command === "CreateNewProject"){
                  $("#modal_dialog").click();
                  console.log("web view, 创建新的项目");
                }else if(message.command === "ProjectRefactor"){
                  console.log("web view, 项目属性修改");
                  $("#modal_dialog_projrefac").click();
                  var project_info = message.project_desc;
                  $("#project_name_projrefac").val(project_info.project_name);
                  $("#select_type_refac").val(project_info.project_type);
                  $("#python_type_projrefac").val(project_info.python_type);
                  $("#ann_lib_type_projrefac").val(project_info.ann_lib_type);
                }
            }else{
              let message = JSON.parse(event.data);
              if(message.proj_select_path){
                console.log("接收到新项目保存路径："+message.proj_select_path);
                $("#proj_save_path_input").val(message.proj_select_path);

                document.getElementById("alert_sheet").style.display = "none";
                document.getElementById("span_save_path").style.color = '#333333';
                document.getElementById("proj_save_path_input").style.borderColor = '';
              }
            }
        });
    });
    // const vscode = acquireVsCodeApi();
    // $("#convertor_entrance").on("click",function(){
    //   console.log("jump back to convertor page");
    //   vscode.postMessage(JSON.stringify({"click":"convertor_page"}));
    // });
</script>