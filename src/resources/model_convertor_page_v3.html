<!DOCTYPE html>
<html style="height: 640px;width: 100%;">

<head>
  <meta charset="UTF-8">
  <title>模型转换器</title>
</head>

<body class="dark-mode" style="height: 100%;width: 100%;overflow: auto;white-space: nowrap;position: relative;">

    <div class="loading-div" id="loader_barchart" style="position: absolute;top: 400px;left: 50px;background: rgba(238,238,238);width: 600px;height: 500px;z-index: 2;">
        <i class="fa fa-spinner fa-pulse fa-3x fa-fw" style="margin-top: 200px;color: #333;"></i>
        <span style="color: #333;height: 50px;width: 120px;display: block;"><font style="margin-left: 240px;font-family: SourceHanSansCN-Normal;
            font-size: 16px;
            color: #333333;
            letter-spacing: 0.91px;">等待转换...</font></span>
    </div>

    <div class="loading-div" id="loader_tb" style="position: absolute;top: 400px;left: 740px;background: rgba(238,238,238);width: 760px;height: 500px;z-index: 2;">
        <i class="fa fa-spinner fa-pulse fa-3x fa-fw" style="margin-top: 200px;color: #333;"></i>
        <span style="color: #333;height: 50px;width: 120px;display: block;"><font style="margin-left: 300px;font-family: SourceHanSansCN-Normal;
            font-size: 16px;
            color: #333333;
            letter-spacing: 0.91px;">等待转换...</font></span>
    </div>

    <div style="height: 140px;background: rgba(238,238,238,0.4);width: 1500px;">
        <div class="col-md-12">
            <div style="text-align: center;margin-left: -60px;"><font style="font-family: SourceHanSansCN-Normal;
                font-size: 20px;
                color: #333333;
                letter-spacing: 1.14px;">转换参数配置</font></div>
            <form role="form" class="row" style="margin-left: 80px;margin-top: 15px;" id="project_info_form">
                <div class="col-md-2" style="text-align: center;margin-left: -60px;">
                    <div><font style="font-family: SourceHanSansCN-Normal;font-weight: normal;
                        font-size: 16px;
                        color: #333333;
                        letter-spacing: 0.91px;">脉冲发放阈值</font></div>
                        <input type="text" id="select_vthresh" style="background: #ffffff;
                        border: 1px solid #D9D9D9;
                        border-radius: 6px;
                        border-radius: 6px;width: 200px;font-family: PingFangSC-Regular;
                        font-size: 12px;
                        padding-top: 10px;
                        padding-bottom: 10px;
                        padding-left: 20px;
                        color: #000000;
                        letter-spacing: 0;
                        line-height: 14px;margin-top: 5px;">
                </div>
                <div class="col-md-2" style="margin-left: 330px;text-align: center;">
                    <label for="select_dt"><font style="font-family: SourceHanSansCN-Normal;font-weight: normal;
                        font-size: 16px;
                        color: #333333;
                        letter-spacing: 0.91px;">时间步</font></label>
                    <select class="form-control" id="select_dt">
                        <option>1ms</option>
                        <option>0.1ms</option>
                    </select>
                </div>
    
                <div class="col-md-2" style="margin-left: 130px;text-align: center;display: none;">
                    <label for="select_synapse_dt"><font style="font-family: SourceHanSansCN-Normal;font-weight: normal;
                        font-size: 16px;
                        color: #333333;
                        letter-spacing: 0.91px;">突触dt</font></label>
                    <select class="form-control" id="select_synapse_dt">
                        <option>1ms</option>
                        <option>0.1ms</option>
                    </select>
                </div>
    
                <div style="margin-left: 28px;text-align: center;display: none;">
                    <label for="select_delay"><font style="font-family: SourceHanSansCN-Normal;font-weight: normal;
                        font-size: 16px;
                        color: #333333;
                        letter-spacing: 0.91px;">delay</font></label>
                    <select class="form-control" id="select_delay">
                        <option>1ms</option>
                        <option>0.1ms</option>
                    </select>
                </div>
    
                <div class="col-md-2" style="margin-left: 300px;text-align: center;">
                    <div for="select_dura"><font style="font-family: SourceHanSansCN-Normal;font-weight: normal;
                        font-size: 16px;
                        color: #333333;
                        letter-spacing: 0.91px;">模拟时间步</font></div>
                            <input type="text" id="select_dura" style="background: #ffffff;
                            border: 1px solid #D9D9D9;
                            border-radius: 6px;
                            border-radius: 6px;width: 200px;font-family: PingFangSC-Regular;
                            font-size: 12px;
                            padding-top: 10px;
                            padding-bottom: 10px;
                            padding-left: 20px;
                            color: #000000;
                            letter-spacing: 0;
                            line-height: 14px;margin-top: 5px;">
                    <!-- <select class="form-control" id="select_dura">
                        <option>100ms</option>
                    </select> -->
                </div>
            </form>
        </div>
    </div>


    <div style="margin-top: 10px;height: 160px;background: rgba(238,238,238,0.4);width: 1500px;">
        <div>
            <div style="text-align: center;margin-left: -60px;"><font style="font-family: SourceHanSansCN-Normal;
                font-size: 20px;
                color: #333333;
                letter-spacing: 1.14px;">转换进度</font></div>
            <div class="row" style="margin-left: 30px;color: #333;">
                <div class="col-md-2" style="text-align: center;">
                    <div style="font-family: SourceHanSansCN-Normal;
                    font-size: 16px;
                    color: #333333;
                    letter-spacing: 0.91px;"><div style="font-size: 2rem;
  width: 2rem;
  opacity: 0.5;
  background-image: -webkit-linear-gradient(180deg, #A5CBFF 0%, #77A4FF 100%);
  display: inline-flex;
  justify-content: center;
  align-items: center;
  border-radius: 20px;">1</div>调整网络结构</div>
                    <div class="progress" style="background: #E6E6E6;
                    border-radius: 30px;height: 40px;margin-top: 10px;">
                        <div id="model_convert_progress_div" class="progress-bar progress-bar-info" role="progressbar"
                             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                             style="width: 0%; opacity: 0.7;
                             background-image: -webkit-linear-gradient(180deg, #A5CBFF 0%, #77A4FF 100%);
                             border-radius: 30px;
                             border-radius: 30px;">
                        </div>
                    </div>
                </div>
            
                <div class="col-md-1" style="margin-top: -10px;">
                    <i style="font-size: 80px;transform: scaleX(2.0);-webkit-background-clip: text;-webkit-text-fill-color: transparent;background-image: linear-gradient(180deg, #FFA73C 50%, #FFDDA6 100%);">—</i>
                </div>
            
                <div class="col-md-2" style="margin-left: -6px;text-align: center;">
                    <div style="font-family: SourceHanSansCN-Normal;
                    font-size: 16px;
                    color: #333333;
                    letter-spacing: 0.91px;"><div style="font-size: 2rem;
  width: 2rem;
  opacity: 0.5;
  background-image: -webkit-linear-gradient(180deg, #A5CBFF 0%, #77A4FF 100%);
  display: inline-flex;
  justify-content: center;
  align-items: center;
  border-radius: 20px;">2</div>权重归一化<span id="self_def_preprocess_alg" style="text-decoration: underline;color: #77A4FF;cursor: pointer;">(自定义实现)</span></div>
                    <div class="progress" style="background: #E6E6E6;
                    border-radius: 30px;height: 40px;margin-top: 10px;">
                        <div id="preprocess_progress_div" class="progress-bar progress-bar-info" role="progressbar"
                             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                             style="width: 0%; opacity: 0.7;
                             background-image: -webkit-linear-gradient(180deg, #A5CBFF 0%, #77A4FF 100%);
                             border-radius: 30px;
                             border-radius: 30px;">
                        </div>
                    </div>
                </div>

                <div class="col-md-1" style="margin-top: -10px;">
                    <i style="font-size: 80px;transform: scaleX(2.0);-webkit-background-clip: text;-webkit-text-fill-color: transparent;background-image: linear-gradient(180deg, #FFA73C 50%, #FFDDA6 100%);">—</i>
                </div>

                <div class="col-md-2" style="margin-left: -6px;text-align: center;">
                    <div style="font-family: SourceHanSansCN-Normal;
                    font-size: 16px;
                    color: #333333;
                    letter-spacing: 0.91px;"><div style="font-size: 2rem;
  width: 2rem;
  opacity: 0.5;
  background-image: -webkit-linear-gradient(180deg, #A5CBFF 0%, #77A4FF 100%);
  display: inline-flex;
  justify-content: center;
  align-items: center;
  border-radius: 20px;">3</div>量化<span id="self_def_opt_alg" style="text-decoration: underline;color: #77A4FF;cursor: pointer;">(自定义实现)</span></div>
                    <div class="progress" style="background: #E6E6E6;
                    border-radius: 30px;height: 40px;margin-top: 10px;">
                        <div id="search_progress_div" class="progress-bar progress-bar-info" role="progressbar"
                             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                             style="width: 0%; opacity: 0.7;
                             background-image: -webkit-linear-gradient(180deg, #A5CBFF 0%, #77A4FF 100%);
                             border-radius: 30px;
                             border-radius: 30px;">
                        </div>
                    </div>
                </div>
            
                <div class="col-md-1" style="margin-top: -10px;">
                    <i style="font-size: 80px;transform: scaleX(2.0);-webkit-background-clip: text;-webkit-text-fill-color: transparent;background-image: linear-gradient(180deg, #FFA73C 50%, #FFDDA6 100%);">—</i>
                </div>
            
                <div class="col-md-2" style="margin-left: -6px;text-align: center;">
                    <div style="font-family: SourceHanSansCN-Normal;
                    font-size: 16px;
                    color: #333333;
                    letter-spacing: 0.91px;"><div style="font-size: 2rem;
  width: 2rem;
  opacity: 0.5;
  background-image: -webkit-linear-gradient(180deg, #A5CBFF 0%, #77A4FF 100%);
  display: inline-flex;
  justify-content: center;
  align-items: center;
  border-radius: 20px;">4</div>SNN验证</div>
                    <div class="progress" style="background: #E6E6E6;
                    border-radius: 30px;height: 40px;margin-top: 10px;">
                        <div id="darlang_progress_div" class="progress-bar progress-bar-info" role="progressbar"
                             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                             style="width: 0%; opacity: 0.7;
                             background-image: -webkit-linear-gradient(180deg, #A5CBFF 0%, #77A4FF 100%);
                             border-radius: 30px;
                             border-radius: 30px;">
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- <div class="row"> -->
                <!-- <span>启动</span> -->
                <!-- <i id="start_convert_btn" class="large material-icons" style="margin-left: 0px;cursor: pointer;">play_circle_outline</i> -->
                <!-- <div class="progress" style="width: 85%;display: inline-block;margin-bottom: 0;margin-left: 60px;background: #E6E6E6;
                border-radius: 15px;">
                    <div id="total_progress_div" class="progress-bar progress-bar-success" role="progressbar"
                         aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                         style="width: 0%; opacity: 0.76;
                         background-image: linear-gradient(180deg, #AED77C 0%, #8FB740 100%);
                         border-radius: 15px;">
                    </div>
                </div>
            </div> -->
        </div>
    </div>

    <div style="height: 560px; margin-top: 10px;width: 1500px;margin-left: -20px;">
        <div class="col-md-12">
            <!-- <div style="width: 350px;height: 560px;display: inline-block;vertical-align: top;white-space:normal;background: rgba(238,238,238,0.4);">
                <div style="font-size: large;font-weight: bold;text-align: center;margin-left: -20px;"><font style="color: #333;font-weight: bold;">日志输出</font></div>
                <div id="log_output_div" style="margin-left: 20px;height: 340px; width: 300px; overflow: auto;margin-top: 60px;color: #333;">
                </div>
            </div> -->
            <div style="width: 660px;height: 560px;display: inline-block;vertical-align: top;background: rgba(238,238,238,0.4);margin-left: 10px;">
                <div style="text-align: center;margin-left: -40px;"><font style="font-family: SourceHanSansCN-Normal;
                    font-size: 20px;
                    color: #333333;
                    letter-spacing: 1.14px;">转换各阶段用时</font></div>
                <div id="use_time_bar_chart" style="width: 560px;height: 440px;margin-top: 15px;margin-left: 40px;"></div>
            </div>
            <div style="height:560px;margin-left: 10px;width: 820px;display: inline-block;vertical-align: top;background: rgba(238,238,238,0.4);">
                <div id="model_layers_vis_tab_caption" style="text-align: center;margin-left: -20px;"><font style="font-family: SourceHanSansCN-Normal;
                    font-size: 20px;
                    color: #333333;
                    letter-spacing: 1.14px;">转换过程信息</font></div>
                <table id="info_simu_table" style="margin-right: auto;margin-top: 60px;display: inline-block;vertical-align: top;color: #333;margin-left: 40px;">
                    <tr style="border: solid 2px #D6D6D6;">
                        <td style="border: solid 2px #D6D6D6;background: #EEEEEE;text-align: center;padding-top: 15px;padding-bottom: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 16px;
                        color: #666666;">转换指标统计</td>
                        <td style="border: solid 2px #D6D6D6;background: #EEEEEE;text-align: center;padding-top: 15px;padding-bottom: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 16px;
                        color: #666666;">统计值</td>
                    </tr>
                    <tr style="border: solid 2px #D6D6D6;">
                        <td style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-left: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">转换总耗时(秒)</td>
                        <td id="total_use_time" style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;text-align: right;padding-left: 80px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">xxx</td>
                    </tr>
                    <tr>
                        <td style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-left: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">平均激发脉冲次数</td>
                        <td id="avg_spike" style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;text-align: right;padding-left: 80px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">xxx</td>
                    </tr>
                    <tr>
                        <td style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-left: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">激发脉冲次数方差</td>
                        <td id="std_spike" style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;text-align: right;padding-left: 80px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">xxx</td>
                    </tr>
                    <tr>
                        <td style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-left: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">连接权重均值</td>
                        <td id="avg_conn_wt" style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;text-align: right;padding-left: 80px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">xxx</td>
                    </tr>
                    <tr>
                        <td style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-left: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">连接权重方差</td>
                        <td id="std_conn_wt" style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;text-align: right;padding-left: 80px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">xxx</td>
                    </tr>
                    <tr>
                        <td style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-left: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">调整网络结构耗时(秒)</td>
                        <td id="stage1_time_use" style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;text-align: right;padding-left: 80px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">xxx</td>
                    </tr>
                    <tr>
                        <td style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-left: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">权重归一化耗时(秒)</td>
                        <td id="stage2_time_use" style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;text-align: right;padding-left: 80px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">xxx</td>
                    </tr>
                    <tr>
                        <td style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-left: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">量化耗时(秒)</td>
                        <td id="stage3_time_use" style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;text-align: right;padding-left: 80px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">xxx</td>
                    </tr>
                    <tr>
                        <td style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-left: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">SNN验证耗时(秒)</td>
                        <td id="stage4_time_use" style="border: solid 2px #D6D6D6;padding-top: 10px;padding-bottom: 10px;padding-right: 10px;text-align: right;padding-left: 80px;font-family: SourceHanSansCN-Medium;
                        font-size: 14px;
                        color: #666666;">xxx</td>
                    </tr>
                </table>
                <table id="scale_factors_table" style="margin-right: auto;margin-top: 60px;display: inline-block;vertical-align: top;border-spacing: 0px 5px;margin-left: 20px;color: #333;">
                    <tr style="border: solid 2px #D6D6D6;">
                        <td style="border: solid 2px #D6D6D6;background: #EEEEEE;text-align: center;padding-top: 15px;padding-bottom: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 16px;
                        color: #666666;">神经层</td>
                        <td style="border: solid 2px #D6D6D6;background: #EEEEEE;text-align: center;padding-top: 15px;padding-bottom: 15px;font-family: SourceHanSansCN-Medium;
                        font-size: 16px;
                        color: #666666;">参数缩放系数</td>
                    </tr>
                    <!-- <tr style="height: 35px;margin-top: 0px;">
                        <td style="width: 100px;font-size: small;font-weight: bold;">层<br/>00Conv2D_26x26x8 参数缩放系数</td>
                        <td>系数1</td>
                    </tr>
                    <tr style="height: 35px;">
                        <td style="width: 100px;font-size: small;font-weight: bold;">缩放系数</td>
                        <td>系数2</td>
                    </tr> -->
                </table>
    
                <!-- <div style="margin-top: 30px;">
                    <div id="model_layers_vis_tab_caption" style="font-size: large;font-weight: bold;text-align: center;">脉冲神经网络输出层脉冲</div>
                    <div id="model_layers_vis_tab_caption" style="font-size: small;font-weight: bold;text-align: center;">统计计数</div>
                    <table id="spike_out_count_table" style="margin-left: 125px;">
                        <tr id="out_labels">
                        </tr>
                        <tr id="out_counts_tr">
                        </tr>
                    </table>
                    <ul id="sample_imgs_ul" style="height: 300px;width: 100px;overflow-x: hidden;display: inline-block;">
                         <li style="list-style: none;margin-bottom: 10px;">
                            <img style="height: 50px;width: 50px;">
                            <span style="text-align: center;">测试标签</span>
                        </li>
                        <li style="list-style: none;margin-bottom: 10px;background-color: chocolate;">
                            <img style="height: 50px;width: 50px;">
                            <span style="text-align: center;">测试标签</span>
                        </li> -->
                    </ul>
                    <!-- <div id="spike_charts" style="width: 420px;height: 340px;margin-left: 25px;display: inline-block;"></div>
                </div> -->
            </div>
        </div>
    </div>

<div class="modal fade" id="myModal_select_alg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_select_alg" aria-hidden="true" style="background-color: white;color: #333;">
    <div class="modal-dialog" style="background-color: white;width: 800px;">
        <div class="modal-content" style="background-color: white;border-radius: 15px;">
            <div style="background: #EEEEEE;padding: 15px; height: 60px; border-top-right-radius: 15px; border-top-left-radius: 15px;">
                <button id="select_alg_modal_close" type="button" class="close" data-dismiss="modal" aria-hidden="true" style="color: rgb(0, 0, 0);
                margin-right: 30px;margin-top: 10px;font-size: 40px;">
                    &times;
                </button>
                <h4 id="myModalLabel_select_alg" style="font-family: SourceHanSansCN-Normal;
                font-size: 24px;
                font-weight: bold;
                color: #333333;
                letter-spacing: 1.07px;margin-left: 20px;">
                    选择调用算法
                </h4>
            </div>
            <div class="modal-body">
        <div style="margin-top: 30px;display: inline-block; width: 50%;">
            <div style="font-family: SourceHanSansCN-Normal;
            font-size: 22px;
            font-weight: bold;
            color: #333333;
            letter-spacing: 1.26px;padding-right: 5px;text-align: right;width: 200px;">预处理步骤：</div>
            <div class="radio" style="margin-top: 30px;margin-left: 80px;">
                <label>
                    <input type="radio" name="alg_call_radios" id="default_alg" value="default_alg" checked> <span style="font-family: SourceHanSansCN-Normal;
                    font-size: 20px;
                    color: #333333;
                    letter-spacing: 1.14px;">默认算法</span>
                </label>
            </div>
            <div class="radio" style="margin-top: 30px;margin-left: 80px;">
                <label>
                    <input type="radio" name="alg_call_radios" id="self_alg" value="self_alg"> <span style="font-family: SourceHanSansCN-Normal;
                    font-size: 20px;
                    color: #333333;
                    letter-spacing: 1.14px;">自定义算法</span>
                </label>
            </div>
        </div>
        <div style="margin-top: 30px;display: inline-block;width: 50%;">
            <div style="font-family: SourceHanSansCN-Normal;
            font-size: 22px;
            font-weight: bold;
            color: #333333;
            letter-spacing: 1.26px;padding-right: 5px;text-align: right;width: 200px;">参数调优步骤：</div>
            <div class="radio" style="margin-top: 30px;margin-left: 80px;">
                <label>
                    <input type="radio" name="opt_alg_call_radios" id="default_opt_alg" value="default_opt_alg" checked> <span style="font-family: SourceHanSansCN-Normal;
                    font-size: 20px;
                    color: #333333;
                    letter-spacing: 1.14px;">默认算法</span>
                </label>
            </div>
            <div class="radio" style="margin-top: 30px;margin-left: 80px;">
                <label>
                    <input type="radio" name="opt_alg_call_radios" id="self_opt_alg" value="self_opt_alg"> <span style="font-family: SourceHanSansCN-Normal;
                    font-size: 20px;
                    color: #333333;
                    letter-spacing: 1.14px;">自定义算法</span>
                </label>
            </div>
        </div>
            </div>
            <div style="margin-top: 40px;margin-bottom: 40px;">
                <button  id="check_alg_select_btn" type="button" class="btn btn-primary" style="background-image: linear-gradient(180deg, #AFD1FF 0%, #77A4FF 100%);
                border-radius: 6px;
                border-radius: 6px;width: 150px;height: 50px;margin-left: calc(40%);" data-dismiss="modal">确认
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<button id="select_alg_modal_btn" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal_select_alg" style="display: none;"></button>

<!-- 错误信息弹窗 -->
<div class="modal fade" id="myModal_exec_error" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_exec_error" aria-hidden="true" style="background-color: white;color: #333;">
    <div class="modal-dialog" style="background-color: white;width: 800px;">
        <div class="modal-content" style="background-color: white;">
            <div>
                <button id="exec_error_modal_close" type="button" class="close" data-dismiss="modal" aria-hidden="true" style="color: rgb(0, 0, 0);margin-right: 30px;">
                    &times;
                </button>
                <h4 id="myModalLabel_exec_error" style="font-family: SourceHanSansCN-Normal;
        font-size: 24px;
        font-weight: bold;
        color: rgb(252, 101, 101);
        letter-spacing: 1.07px;margin-left: 20px;">
                    转换代码执行错误
                </h4>
            </div>
            <div id="error_msg_div" class="modal-body" style="overflow:scroll;white-space: pre-line;height: 400px;">
            </div>
            <div style="margin-top: 40px;margin-bottom: 40px;">
                <button  id="exec_error_btn" type="button" class="btn btn-primary" style="background-image: linear-gradient(180deg, #AFD1FF 0%, #77A4FF 100%);
        border-radius: 2px;
        border-radius: 2px;width: 100%;margin: auto;text-align: center;display: inline-block;" data-dismiss="modal">确认
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<button id="exec_error_modal_btn" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal_exec_error" style="display: none;"></button>

<!-- 总进度提示 -->
<!-- <div id="total_progress_ball" class="box" style="display: none;position: fixed;left: calc(50vw - 100px);">
    <svg class="wave" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 200 210">
      <defs>
        <path id="wave-shape" stroke="rgba(255,255,255,.8)" stroke-width=".5" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 58-18 88-18 58 18 88 18 v185h-528z"></path>
      </defs>
      <g class="parallax">
        <use xlink:href="#wave-shape" x="50" y="0" fill="url(#linear)"></use>
        <use xlink:href="#wave-shape" x="50" y="3" fill="url(#linear)"></use>
        <use xlink:href="#wave-shape" x="50" y="6" fill="url(#linear)"></use>
      </g>
      <defs>
        <linearGradient id="linear" x1="0%" y1="0%" x2="100%" y2="0%" gradientTransform="rotate(90)">
          <stop offset="30%"   stop-color="#304CA6" stop-opacity="0.2" />
        </linearGradient>
      </defs>
      <text id="total_progress_text" x="90" y="30"
        font-family="SimHei"
        font-size="20px"
        margin-top="30px"
        margin-left="100px"
        stroke="#304CA6">
        0%
    </text>
    </svg>
</div> -->
<div id="total_progress_ball" class="pie" style="display: none;">
</div>


<div class="modal fade" id="myModal_show_error" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_show_error" aria-hidden="true" style="background-color: white;color: #333;">
	<div class="modal-dialog" style="background-color: white;width: 500px;">
		<div class="modal-content" style="background-color: white;">
			<div style="height:70px; margin-top: -10px; background: #EEEEEE;border-top-right-radius: 15px; border-top-left-radius: 15px;padding-top: 10px;">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="color: rgb(0, 0, 0);margin-right: 30px;margin-top: 10px;">
					&times;
				</button>
				<h4 id="myModalLabel_show_error" style="font-family: SourceHanSansCN-Normal;
        font-size: 24px;
        letter-spacing: 1.07px;margin-left: 20px;">
					警告
				</h4>
			</div>
			<div class="modal-body">
        <div id="modal_dialog_error_icon" align="center" style="height: 120px; padding-top: 30px;" ><img src="http://127.0.0.1:6003/src/img/warning.png" height=96px; width=96px; alt="警告"></div>
        <div style="margin-top: 10px; width: 500px; height: 100px;">
          <div id="error_detail" for="project_name_projrefac" style="font-family: SourceHanSansCN-Bold;font-size: 28px;color: #666666;letter-spacing: 1.25px; text-align: center;padding-left: 50px;overflow-y: auto;white-space: pre-wrap;height: 100%;width: 95%;">错误信息</div>
        </div>
			</div>
			<div style="margin-top: 40px;margin-bottom: 40px;">
				<button id="error_dialog_close_btn" type="button" class="btn btn-primary" style="background-image: linear-gradient(180deg, #AFD1FF 0%, #77A4FF 100%);
                border-radius: 2px;
                margin-left: 180px;width: 150px;height: 50px; text-align: center;display: inline-block;" data-dismiss="modal">关闭
				</button>
                <button type="button" class="btn btn-primary" style="background-image: linear-gradient(180deg, #ffccaf 0%, #e93434 100%);
                border-radius: 2px;
                margin-left: 100px;width: 160px;height: 50px; text-align: center;display: none;" id="stp_compile_btn">停止编译
                </button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>

<button id="alert_modal_btn" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal_show_error" style="display: none;"></button>


<!-- 二进制文件重命名提示框 -->
<div class="modal fade" id="compile_binary_rnm_dialog" tabindex="-1" role="dialog" aria-labelledby="compile_binary_rnm_dialog_label" aria-hidden="true" 
                style="background-color: white;color: #333;">
    <div class="modal-dialog" style="background-color: white; width: 747px">
      <div class="modal-content" style="width: 747px; height: 360px; background-color: white;border-radius: 15px;">
        <div style="background: #EEEEEE; height: 60px; border-top-right-radius: 15px; border-top-left-radius: 15px;">
          <button type="button" id="close_binary_fname_dialog_btn" class="close" data-dismiss="modal" aria-hidden="true" style="color: rgb(0, 0, 0);
          margin-right: 30px;
          width: 30px;
          height: 30px;
          margin-top: 9px;
          padding-top: 15px;
          display: none;
          ">
            &times;
          </button>
          <div id="compile_binary_rnm_dialog_label" style="font-family: SourceHanSansCN-Medium;
          font-size: 24px;
          color: #333333;
          font-weight: bold;
          letter-spacing: 1.26px;padding-left: 29px;padding-top: 15px;
        ">
            重命名二进制文件
          </div>
        </div>
        <div>
                  <form role="form" id="binary_model_file">

                    <div>
                        <label for="option_label" style="font-family: SourceHanSansCN-Normal;
                        font-size: 22px;
                        color: #333333;
                        letter-spacing: 1.26px;padding-right: 5px;text-align: right;width: 200px;margin-left: 100px;">是否重命名编译生成二进制文件：</label>
                        <select id="option_label" style="margin-top: 20px; margin-left: 160px;background: white; 
                        border: 1px solid #D9D9D9;
                        border-radius: 6px;
                        border-radius: 6px;width: 80px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;">
                          <option>是</option>
                          <option>否</option>
                        </select>
                    </div>

                      <div id="bin_model_div" style="margin-top: 15px;">
                          <label for="bin_model_name" id="lb_bin_model_name" style="font-family: SourceHanSansCN-Normal;
                          font-size: 22px;
                          color: #333333;
                          letter-spacing: 1.26px;padding-right: 5px;text-align: right;width: 200px;margin-left: 30px;">模型文件名: </label>
                          <input type="text" id="bin_model_name" style="background: white; 
                          border: 1px solid #D9D9D9;
                          border-radius: 6px;
                          border-radius: 6px;width: 400px;font-family: PingFangSC-Regular;
  font-size: 22px;
  color: #999999;
  letter-spacing: 0;
  line-height: 14px;" placeholder=".b后缀文件名">
                      </div>
                      <p id="bin_model_fname_error" style="font-family: SourceHanSansCN-Normal;
                      font-size: 18px;
                      color:  #EC7760;
                      margin-left: 204px;
                      margin-bottom: 2px;
                      letter-spacing: 1.15px;
                      height: 20px;
                      display: none;">名称长度为9以内，小写英文字母，.b 后缀</p>

                      <div id="bin_pack_file_div" style="margin-top: 15px;">
                        <label for="bin_pack_file_name" id="lb_bin_pack_file_name" style="font-family: SourceHanSansCN-Normal;
                        font-size: 22px;
                        color: #333333;
                        letter-spacing: 1.26px;padding-right: 5px;text-align: right;width: 200px;margin-left: 30px;">编解码配置文件名: </label>
                        <input type="text" id="bin_pack_file_name" style="background:white; 
                        border: 1px solid #D9D9D9;
                        border-radius: 6px;
                        border-radius: 6px;width: 400px;font-family: PingFangSC-Regular;
font-size: 22px;
color: #999999;
letter-spacing: 0;
line-height: 14px;" placeholder=".dat后缀文件名">
                    </div>
                    <p id="bin_pack_fname_err" style="font-family: SourceHanSansCN-Normal;
                    font-size: 18px;
                    color:  #EC7760;
                    margin-left: 204px;
                    margin-bottom: 2px;
                    letter-spacing: 1.15px;
                    height: 20px;
                    display: none;">名称长度为30以内，小写英文字母、下划线，.dat 后缀</p>

                  </form>
        </div>
        <div style="margin-top: 40px;margin-bottom: 40px;">
            <button type="button" class="btn btn-default" data-dismiss="modal" id="dismiss_compile_dialog" style="background: #F3F3F3;
            border: 1px solid #D7D7D7;
            border-radius: 4px;
            border-radius: 4px;width: 140px;margin-left: 160px;">取消编译
            </button>
            <button type="button" class="btn btn-primary" onclick="binary_compile_check()" id="binary_file_ok_btn" style="background-image: linear-gradient(180deg, #AFD1FF 0%, #77A4FF 100%);
            border-radius: 4px;
            border-radius: 4px;width: 140px;height: 40px;margin-left: 120px;">开始编译
            </button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal -->
  </div>

  <button id="rnm_binary_btn" class="btn btn-primary btn-lg" data-toggle="modal" data-dismiss="modal" data-target="#compile_binary_rnm_dialog" style="display: none;"></button>

</body>
<style>

/* progress {
  border-radius: 7px; 
  width: 80%;
  height: 22px;
  margin-left: -11.5%;
  box-shadow: 1px 1px 4px rgba( 0, 0, 0, 0.2 );
}
progress::-webkit-progress-bar {
    background: #E6E6E6;
    border-radius: 15px;
    border-radius: 15px;
}
progress::-webkit-progress-value {
    background-color: blue;
    opacity: 0.7;
    background-image: -webkit-linear-gradient(180deg, #A5CBFF 0%, #77A4FF 100%);
    border-radius: 15px;
} */

*{
      margin:0;
    }
    .box{
      width: 200px;
      height: 200px;
      left: 40%;
      top: 50%;
      /* margin: 50px auto; */
      background-image: linear-gradient(-180deg, rgba(255,255,255,0.00) 0%, rgba(87, 178, 231, 0.96) 68%);
      border-radius: 100%;
      overflow: hidden;
      position: absolute;
      z-index: 3;
    }
    .box:before{
      content: '';
      width: 180px;
      height: 180px;
      background-image: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(87, 178, 231, 0.96) 68%);
      border-radius: 100%;
      position: absolute;
      left: 10px;
      top: 10px;
    }
    .box:after{
      content: '';
      width: 160px;
      height: 160px;
      background-image: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(87, 178, 231, 1) 50%);
      border-radius: 100%;
      position: absolute;
      left: 20px;
      top: 20px;
    }
    .wave{
      margin-top: 0px;
      width: 100%;
      height: 560px; /*560px progress 0, 200 progress 100*/
      position: relative;
      overflow: hidden;
      z-index: 4;
    }
    .parallax>use {
      animation: wave-move 1s linear infinite;
      animation-duration: .9s;
    }
    .parallax>use:nth-child(1) {
      animation-delay: -.1s;
    }
    .parallax>use:nth-child(2) {
      animation-delay: -.5s;
    }
    .parallax>use:nth-child(3) {
      animation-delay: -.8s;
    }
    @keyframes wave-move {
      0% {
        transform: translate(90px,0);
      }
      100% {
        transform: translate(-85px,0);
      }
    }

.titlebar {
  -webkit-user-select: none;
  -webkit-app-region: drag;
}

.titlebar-button {
  -webkit-app-region: no-drag;
}

body {
  padding: 25px;
  background-color: rgb(251, 255, 255);
  color: white;
  font-size: 25px;
}

.dark-mode {
  background-color: rgb(249, 251, 252);
  color: white;
}
  @font-face {
    font-family: 'Material Icons';
    font-style: normal;
    font-weight: 400;
    src: local('Material Icons'), local('MaterialIcons-Regular'), url(http://localhost:6003/js/gfont.woff2) format('woff2');
  }

  .material-icons {
    font-family: 'Material Icons';
    font-weight: normal;
    font-style: normal;
    font-size: 24px;
    line-height: 1;
    text-transform: none;
    display: inline-block;
    -webkit-font-feature-settings: 'liga';
    -webkit-font-smoothing: antialiased;
  }

.loading-div {
    display: table-cell;
    vertical-align: middle;
    overflow: hidden;
    text-align: center;
}
.loading-div::before {
  display: inline-block;
  vertical-align: middle;
} 

.pie {
    display: flex;
    width: 15vw;
    height: 15vw;
    position: absolute;
    opacity: 60%;
    margin-left: 540px;
    margin-top: -600px;
    z-index: 9;
}
</style>
<!-- Compiled and minified CSS -->
<link rel="stylesheet" href="http://localhost:6003/css/bootstrap337.min.css">

<script src="http://localhost:6003/js/jquery211.min.js"></script>
<script src="http://localhost:6003/js/bootstrap337.min.js"></script>
<script src="http://localhost:6003/js/echarts501.min.js"></script>
<link rel="stylesheet" href="http://localhost:6003/css/font-awesome.min.css">

<script>

const vscode = acquireVsCodeApi();
let stage1_convert_finish=false;
let stage2_preprocess_finish=false;
let stage3_search_finish=false;
let stage4_all_finish=false;

let config_fname = undefined;
let pack_fname = undefined;

let error_occurred = false;

let log_output_lists = new Array();

let prev_clicked_img_li_id=undefined;
var process_pie_option = {
    // backgroundColor: '#2F4056',//背景颜色
    title: {
        text: '',//圆环中间显示的数值单位
        subtext: '',//圆环数值单位下面的描述文字
        x: 'center',
        y: 'center',
        itemGap: 15,//描述文字与上面数值单位的垂直距离
        textStyle: {
            color: '#666666',
            fontSize: 16,
        },
        subtextStyle: {
            color: 'rgba(255,255,255,0.7)',
            fontSize: 16,
        }
    },
    tooltip: {//提示框浮层属性
        show: true,
        transitionDuration: 0.8,
        formatter: "{a} - {c}%"//提示框浮层内容格式器，支持字符串模板和回调函数两种形式
    },
    series: [{
        name: '',
        type: 'pie',//饼图类型
        radius: ['72%', '100%'],//饼图的内、外半径
        hoverAnimation: false,
        label: {
            normal: {
                show: false,
            }
        },
        itemStyle: {
            normal: {
                color: '#666666',
            }
        },
        data: [{//系列中的数据内容数组
            value: 0,
            itemStyle: {
                normal: {
                    color: '#FF994B'
                }
            }
        }, {
            value: 100,
        }
        ],
        animationEasingUpdate: 'cubicInOut',
        animationDurationUpdate: 10
    }]
};

$("#stp_compile_btn").on("click", (e) => {
    vscode.postMessage(JSON.stringify({"stop_compile": "yes"}));
    console.log("发送停止编译。。。。");
    $("#alert_modal_btn").click();
});


$("#option_label").on("change", (e)=> {
    console.log("编译二进制文件对话框选项切换");
    let opt_compile = $("#option_label").val();
    if (opt_compile === "是") {
        $("#bin_model_name").prop("disabled", false);
        $("#bin_pack_file_name").prop("disabled", false);
        $("#bin_model_name").css("background", "white");
        $("#bin_pack_file_name").css("background", "white");
    } else {
        $("#bin_model_name").prop("disabled", true);
        $("#bin_pack_file_name").prop("disabled", true);
        $("#bin_model_name").css("background", "rgb(209,209,209)");
        $("#bin_pack_file_name").css("background", "rgb(209,209,209)");
        $("#bin_model_name").val("config.b");
        $("#bin_pack_file_name").val("packed_bin_files.dat");
    }
});

$("#bin_model_name").on('change', (e)=> {
    $("#bin_model_fname_error").css("display", "none");
    $("#bin_pack_fname_err").css("display", "none");
});

$("#bin_pack_fname_err").on('change', (e) => {
    $("#bin_model_fname_error").css("display", "none");
    $("#bin_pack_fname_err").css("display", "none");
});

function binary_compile_check() {
    $("#bin_model_fname_error").css("display", "none");
    $("#bin_pack_fname_err").css("display", "none");
    config_fname = $("#bin_model_name").val().toString().trim();
    pack_fname = $("#bin_pack_file_name").val().toString().trim();
    console.log("config file name="+config_fname);
    console.log("packed file name="+pack_fname);
    if (config_fname.length === 0 || config_fname.length >= 10) {
        $("#bin_model_fname_error").text("名称长度为9以内，数字小写英文字母，.b 后缀");
        $("#bin_model_fname_error").css("display", "block");
        console.log("bin fname length check failed.");
    } else if (pack_fname.length == 0 || pack_fname.length >= 30) {
        $("#bin_pack_fname_err").text("名称长度为30以内，小写英文字母、下划线，.dat 后缀");
        $("#bin_pack_fname_err").css("display", "block");
        console.log("bin pack fname length failed.");
    } else {
        for (var i =0; i < config_fname.length - 2;++i) {
            if (!((config_fname[i] >= 'a' && config_fname[i] <= 'z') || (config_fname[i] >= '0' && config_fname[i] <= '9'))) {
                $("#bin_model_fname_error").text("名称长度为9以内，数字小写英文字母，.b 后缀");
                $("#bin_model_fname_error").css("display", "block");
                console.log("bin model file name check failed.");
                return;
            }
        }
        if(!(config_fname[config_fname.length - 2] === '.' && config_fname[config_fname.length - 1] >= 'a' && config_fname[config_fname.length - 1] <= 'z')) {
            $("#bin_model_fname_error").text("后缀需要是 .b");
            $("#bin_model_fname_error").css("display", "block");
            console.log("bin model file name suffix check failed")
            return;
        }

        for (var i =0; i < pack_fname.length - 4; ++i) {
            if (!((pack_fname[i] >= 'a' && pack_fname[i] <= 'z') || pack_fname[i] === '_' || (pack_fname[i] >= '0' && pack_fname[i] <= '9'))) {
                $("#bin_pack_fname_err").text("名称长度为30以内，小写英文字母、下划线，.dat 后缀");
                $("#bin_pack_fname_err").css("display", "block");
                console.log("pack file name check failed");
                return;
            }
        }
        if (pack_fname.substr(pack_fname.length - 4) !== ".dat") {
            $("#bin_pack_fname_err").text("后缀需要是  .dat");
            $("#bin_pack_fname_err").css("display", "block");
            console.log("bin pack file suffix check failed");
            return;
        }

        $("#close_binary_fname_dialog_btn").click();
        // 发送到extension
        vscode.postMessage(JSON.stringify({"config_fname": config_fname, "pack_fname": pack_fname}));
    }
}


function process_pie_init(option) {
    let processByPie = echarts.init(document.getElementById("total_progress_ball"));
    option.title.text = "0%";
    processByPie.setOption(option);
    return processByPie;
}

function process_pie_update(process_pie, option, percent) {
    option.series[0].data[0].value = percent;
    option.series[0].data[1].value = 100 - percent;
    option.title.text = ""+percent+"%";
    process_pie.setOption(option, true);
}

function process_pie_end(process_pie, option) {
    option.series[0].data[0].value = 100;
    option.series[0].data[1].value = 0;
    option.title.text = "100%";
    process_pie.setOption(option, true);
}

function process_pie_reset(process_pie, option) {
    option.series[0].data[0].value = 0;
    option.series[0].data[1].value = 100;
    option.title.text = "0%";
    process_pie.setOption(option, true);
}

let processPie = undefined;

// each stage finish stub
let s1_fin_stub = 152;
let s2_fin_stub = 228;
let s3_fin_stub = 330;
let s4_fin_stub = 397;

      $(document).ready(function(){
        $("#select_vthresh").val("21"); // default value
        $("#select_dura").val("100");
          $("#self_def_preprocess_alg").on("click", function(){
              vscode.postMessage(JSON.stringify({"convert_self_def": "preprocess"}));
          });
          $("#self_def_opt_alg").on("click", function(){
              vscode.postMessage(JSON.stringify({"convert_self_def": "opt"}));
          });
          $("#check_alg_select_btn").on("click", ()=>{
              msg = {}
              if (document.getElementById("default_alg").checked) {
                  msg["select_alg_res"] = "default";
              } else {
                  msg["select_alg_res"] = "self";
              }

              if (document.getElementById("default_opt_alg").checked) {
                  msg["select_alg_res_opt"] = "default";
              } else {
                  msg["select_alg_res_opt"] = "self";
              }
              console.log("向 extension 发送选择调用的算法 ： " + JSON.stringify(msg));
              vscode.postMessage(JSON.stringify(msg));
            });
          window.addEventListener("message", function(evt){
              console.log("ANN 转SNN 模型接收到extension 消息："+evt.data);
              const data = JSON.parse(evt.data);
              if(data.log_output){
                log_output_lists = log_output_lists.concat(data.log_output.split("<br/>"));
                console.log("data.logoutput=["+data.log_output+"]");
                console.log("data split list len="+log_output_lists.length);
                // $("#log_output_div").html(log_output_lists.join("<br/>"));
                // document.getElementById("log_output_div").scrollTop = document.getElementById("log_output_div").scrollHeight;
                if(log_output_lists.length <= s1_fin_stub){
                    console.log("increase sub progress bar 1, style width="+""+parseInt(log_output_lists.length/s1_fin_stub*100)+"%");
                        document.getElementById("model_convert_progress_div").style.width = ""+parseInt(log_output_lists.length/s1_fin_stub*100)+"%";
                }
                if(stage1_convert_finish){
                    if(log_output_lists.length < s2_fin_stub && stage2_preprocess_finish !== true){
                        console.log("increase sub progress bar 2");
                            document.getElementById("preprocess_progress_div").style.width = ""+parseInt((log_output_lists.length-s1_fin_stub)/(s2_fin_stub-s1_fin_stub)*100)+"%";
                    }
                }
                if(stage2_preprocess_finish){
                    if(log_output_lists.length < s3_fin_stub && stage3_search_finish !== true){
                        console.log("increase sub progress bar 3");
                            document.getElementById("search_progress_div").style.width = ""+parseInt((log_output_lists.length-s2_fin_stub)/(s3_fin_stub-s2_fin_stub)*100)+"%";
                    }
                }
                if(stage3_search_finish){
                    if(log_output_lists.length < s4_fin_stub && stage4_all_finish !== true){
                        console.log("increase sub progress bar 4");
                            document.getElementById("darlang_progress_div").style.width = ""+parseInt((log_output_lists.length-s3_fin_stub)/(s4_fin_stub-s3_fin_stub)*100)+"%";
                    }
                }
                // if(stage4_all_finish !== true){
                //     console.log("increase sub progress bar total");
                //     document.getElementById("total_progress_div").style.width = ""+parseInt(log_output_lists.length/397*100)+"%";
                // }
                // $(".wave").attr("height", ""+(560 - Math.floor(log_output_lists.length / 397 * (560 - 200)))+"px");
                // $(".wave").css("height",  ""+(560 - Math.floor(log_output_lists.length / 397 * (560 - 200)))+"px");
                // $("#total_progress_text").text(""+Math.min(Math.floor((log_output_lists.length / 397) * 100), 100)+"%");
                process_pie_update(processPie, process_pie_option, Math.min(Math.floor((log_output_lists.length / s4_fin_stub) * 100), 100));
                document.getElementById("model_convert_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>"+Math.min(parseInt(document.getElementById("model_convert_progress_div").style.width.replace("%", "")), 100)+"%</div>";
                document.getElementById("preprocess_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>"+Math.min(parseInt(document.getElementById("preprocess_progress_div").style.width.replace("%", "")), 100)+"%</div>";
                document.getElementById("search_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>"+Math.min(parseInt(document.getElementById("search_progress_div").style.width.replace("%", "")), 100)+"%</div>";
                document.getElementById("darlang_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>"+Math.min(parseInt(document.getElementById("darlang_progress_div").style.width.replace("%", "")), 100)+"%</div>";
                // document.getElementById("total_progress_div").innerHTML = "<span style='color: #333;'>"+Math.min(parseInt(document.getElementById("total_progress_div").style.width.replace("%", "")), 100)+"%</span>";
              }else if(data.exec_finish){
                  if (!error_occurred) {
                    // 结束
                    //   document.getElementById("start_convert_btn").style.backgroundColor = "";
                    console.log("total finished, log_output_list length="+log_output_lists.length);
                    document.getElementById("model_convert_progress_div").style.width = "100%";
                    document.getElementById("preprocess_progress_div").style.width = "100%";
                    document.getElementById("search_progress_div").style.width = "100%";
                    document.getElementById("darlang_progress_div").style.width = "100%";
                    $("#total_progress_text").text("100%");
                    //   document.getElementById("total_progress_div").style.width = "100%";
                    document.getElementById("model_convert_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>100%</div>";
                    document.getElementById("preprocess_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>100%</div>";
                    document.getElementById("search_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>100%</div>";
                    document.getElementById("darlang_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>100%</div>";
                    // document.getElementById("total_progress_div").innerHTML = "<span style='color: #333;'>100%</span>";
                    console.log("LINE COUNT all_finish="+log_output_lists.length);
                    $(".loading-div").hide();
                    document.getElementById("total_progress_ball").style.display = "none";
                    stage4_all_finish = true;
                  }
              }else if(data.progress){
                  // 处理进度信息
                  if(data.progress === "convert_finish"){
                      document.getElementById("model_convert_progress_div").style.width = "100%";
                      console.log("LINE COUNT convert_finish="+log_output_lists.length);
                      stage1_convert_finish = true;
                  }else if(data.progress === "preprocess_finish"){
                      document.getElementById("preprocess_progress_div").style.width = "100%";
                      console.log("LINE COUNT preprocess_progress_div="+log_output_lists.length);
                      stage2_preprocess_finish = true;
                  }else if(data.progress === "search_finish"){
                      document.getElementById("search_progress_div").style.width = "100%";
                      console.log("LINE COUNT search_progress_div="+log_output_lists.length);
                      stage3_search_finish = true;
                  }
              }else if(data.snn_info){
                  // snn 相关数据
                //   const infos = JSON.parse(data.snn_info);
                //   var test_img_uls = document.getElementById("sample_imgs_ul");
                //   var test_img_uris = infos.spikes.snn_test_imgs;
                //   var test_img_spikes = infos.spikes.snn_test_spikes;
                //   console.log("spiking img uris[0]"+test_img_uris[0]);
                //   console.log("spiking spike infos[0]="+test_img_spikes[0].cls_names);
                //   console.log("spike tuples[0]="+test_img_spikes[0].spike_tuples);

                //   for(let i=0;i<test_img_uris.length;++i){
                //     var img_li = document.createElement("li");
                //     img_li.id = "img_li_"+i;
                //     img_li.style.listStyle = "none";
                //     img_li.style.marginBottom = "10px";
                //     var img_tag = document.createElement("img");
                //     img_tag.id = "sample_img_"+i;
                //     img_tag.src = test_img_uris[i];
                //     img_tag.style.width = "50px";
                //     img_tag.style.height = "50px";

                //     img_li.appendChild(img_tag);
                //     test_img_uls.appendChild(img_li);

                //     var label_span = document.createElement("span");
                //     label_span.innerText = "标签: "+test_img_uris[i].split("_")[5].split(".")[0];
                //     img_li.appendChild(label_span);

                //     img_tag.onclick = function(){
                //       console.log("draw NO."+i+" img and spikes");
                //       console.log("reset background color of prev:"+prev_clicked_img_li_id);
                //       if(prev_clicked_img_li_id !== undefined){
                //           document.getElementById(prev_clicked_img_li_id).style.backgroundColor = "";
                //       }
                //       console.log("set background color of li: "+ "img_li_"+i);
                //       document.getElementById("img_li_"+i).style.backgroundColor = "chocolate";
                //       prev_clicked_img_li_id = "img_li_"+i;
                //       display_spike_scatter_chart(test_img_spikes[i].cls_names, test_img_spikes[i].spike_tuples);

                //       // display counts in table
                //       let cls_idx = test_img_spikes[i].spike_tuples[0][0];
                //       let curr_count=1;
                //       let spike_counts = new Array();
                //       for(let j=0;j<test_img_spikes[i].cls_names.length;++j){
                //           spike_counts.push(0);
                //       }
                //       for(let j=1;j<test_img_spikes[i].spike_tuples.length;++j){
                //           if(cls_idx === test_img_spikes[i].spike_tuples[j][0]){
                //               curr_count = curr_count+1;
                //           }else{
                //               spike_counts[cls_idx] = curr_count;
                //               curr_count=1;
                //               cls_idx = test_img_spikes[i].spike_tuples[j][0];
                //           }
                //       }
                //       spike_counts[spike_counts.length-1] = curr_count;
                //       document.getElementById("out_labels").innerHTML = "";
                //       let td_child = document.createElement("td");
                //       td_child.innerText = "计数值:";
                //       td_child.style.width = "60px";
                //       document.getElementById("out_labels").appendChild(td_child);

                //       document.getElementById("out_counts_tr").innerHTML = '';
                //       td_child = document.createElement("td");
                //       td_child.innerText = "标签名称:";
                //       td_child.style.width = "60px";
                //       document.getElementById("out_counts_tr").appendChild(td_child);

                //       for(let j=0;j<spike_counts.length;++j){
                //         let td_child = document.createElement("td");
                //         td_child.innerText = spike_counts[j];
                //         td_child.style.width = "33px";
                //         document.getElementById("out_counts_tr").appendChild(td_child);

                //         td_child = document.createElement("td");
                //         td_child.innerText = test_img_spikes[i].cls_names[j];
                //         td_child.style.width = "33px";
                //         document.getElementById("out_labels").appendChild(td_child);
                //       }
                //     }
                //   }
              }else if(data.convert_info){
                  const convert_infos = JSON.parse(data.convert_info);
                  $("#total_use_time").text(convert_infos.total_use_time.replace("秒",""));
                  $("#avg_spike").text(convert_infos.spk_mean);
                  $("#std_spike").text(convert_infos.spk_std);
                  $("#avg_conn_wt").text(convert_infos.wt_mean);
                  $("#std_conn_wt").text(convert_infos.wt_std);
                  $("#stage1_time_use").text(convert_infos.stage1_time_use);
                  $("#stage2_time_use").text(convert_infos.stage2_time_use);
                  $("#stage3_time_use").text(convert_infos.stage3_time_use);
                  $("#stage4_time_use").text(convert_infos.stage4_time_use);

                  let bar_chart_label_names = ["调整网络结构", "权重归一化", "量化", "SNN验证"];
                  let bar_chart_label_counts = [parseFloat(convert_infos.stage1_time_use), parseFloat(convert_infos.stage2_time_use),
                                parseFloat(convert_infos.stage3_time_use), parseFloat(convert_infos.stage4_time_use)];
                  display_bar_chart(bar_chart_label_names, bar_chart_label_counts, "","秒","use_time_bar_chart");
              }else if(data.ann_model_start_convert){
                  // 接收到启动转换的命令，初始化
                error_occurred = false;

                let v_thresh = $("#select_vthresh").val().replace("ms","");
                let neuron_dt = $("#select_dt").val().replace("ms","");
                // let synapse_dt = $("#select_synapse_dt").val().replace("ms","");
                let synapse_dt = neuron_dt;
                let delay = $("#select_delay").val().replace("ms", "");
                let dura = $("#select_dura").val().replace("ms","");

                // 字段检查
                if (v_thresh.indexOf(".") >= 0 || Number.isNaN(parseInt(v_thresh))) {
                    $("#error_detail").text("'脉冲发放阈值'应该是整数！");
                    $("#alert_modal_btn").click();
                } else {
                    document.getElementById("total_progress_ball").style.display = "flex";
                    // $(".wave").attr("height", "560px");
                    processPie = process_pie_init(process_pie_option);
                    console.log("v_thresh="+v_thresh+", neuron_dt="+neuron_dt+", synapse_dt="+synapse_dt+", delay="+delay);
                    vscode.postMessage(JSON.stringify({"model_convert_params":{
                        "vthresh": v_thresh,
                        "neuron_dt": neuron_dt,
                        "synapse_dt":synapse_dt,
                        "delay":delay,
                        "dura":dura
                    }}));
                    log_output_lists.splice(0);
                    stage1_convert_finish = false;
                    stage2_preprocess_finish = false;
                    stage3_search_finish = false;
                    stage4_all_finish = false;
                    document.getElementById("model_convert_progress_div").style.width = "0%";
                    document.getElementById("preprocess_progress_div").style.width = "0%";
                    document.getElementById("search_progress_div").style.width = "0%";
                    document.getElementById("darlang_progress_div").style.width = "0%";
                    $("#total_progress_text").text("0%");
                    // document.getElementById("total_progress_div").style.width = "0%";
                    $(".loading-div").show();
                    $("#total_progress_text").text("0%");
                }
              }else if(data.scale_factors){
                // scale_factors_table
                // <tr style="margin-top: 15px;height: 35px;">
                //     <td style="width: 200px;font-size: medium;font-weight: bold;">缩放系数</td>
                //     <td>系数2</td>
                // </tr> -->
                scale_fac = JSON.parse(data.scale_factors);
                // document.getElementById("scale_factors_table").innerHTML = "";
                // console.log("scale factor table children len="+$("#scale_factors_table").children.length);
                // while ($("#scale_factors_table").children.length > 1) {
                //     $("#scale_factors_table tr:last").remove();
                // }
                // console.log("scale factor table children len after remove ="+$("#scale_factors_table").children.length);
                document.getElementById("scale_factors_table").innerHTML = "<tr style='border: solid 2px #D6D6D6;'>\
<td style='border: solid 2px #D6D6D6;background: #EEEEEE;text-align: center;padding-top: 15px;padding-bottom: 15px;font-family: SourceHanSansCN-Medium;\
font-size: 16px;\
color: #666666;'>神经层</td>\
<td style='border: solid 2px #D6D6D6;background: #EEEEEE;text-align: center;padding-top: 15px;padding-bottom: 15px;font-family: SourceHanSansCN-Medium;\
font-size: 16px;\
color: #666666;'>参数缩放系数</td>\
</tr>";
                for(obj in scale_fac){
                    let table_line = document.createElement("tr");
                    table_line.style.height = "35px";
                    table_line.style.border = "solid 2px #D6D6D6";
                    table_line.style.color = "#333";
                    let line_td1 = document.createElement("td");
                    line_td1.style.border = "solid 2px #D6D6D6";
                    line_td1.style.paddingTop = '10px';
                    line_td1.style.paddingBottom = '10px';
                    line_td1.style.paddingLeft = '10px';
                    line_td1.style.paddingRight = '80px';
                    line_td1.style.fontFamily = 'SourceHanSansCN-Medium';
                    line_td1.style.fontSize = '14px';
                    line_td1.style.color = '#666666';
                    line_td1.innerHTML = ""+obj;
                    table_line.appendChild(line_td1);
                    let line_td2 = document.createElement("td");
                    line_td2.style.border = "solid 2px #D6D6D6";
                    line_td2.style.paddingTop = '10px';
                    line_td2.style.paddingBottom = '10px';
                    line_td2.style.paddingRight = '10px';
                    line_td2.style.paddingLeft = '80px';
                    line_td2.style.textAlign = 'right';
                    line_td2.style.fontFamily = 'SourceHanSansCN-Medium';
                    line_td2.style.fontSize = '14px';
                    line_td2.style.color = '#666666';
                    line_td2.innerText = parseFloat(scale_fac[obj]).toFixed(3);
                    table_line.appendChild(line_td2);
                    document.getElementById("scale_factors_table").appendChild(table_line);
                }
              } else if (data.select_default_or_self_alg) {
                  // 弹出对话框，选择使用默认算法/自定义算法
                  $("#select_alg_modal_btn").click();
                //   $("#select_alg_modal_close").on("click",()=>{
                //     if (document.getElementById("default_alg").checked) {
                //           console.log("选择使用默认算法....");
                //           vscode.postMessage(JSON.stringify({"select_alg_res": "default"}));
                //       } else {
                //           console.log("选择使用自定义算法...");
                //           vscode.postMessage(JSON.stringify({"select_alg_res":"self"}));
                //       }
                //   });
              } else if (data.exec_error) {
                  error_occurred = true;
                // 重置界面状态
                document.getElementById("scale_factors_table").innerHTML = "<tr style='border: solid 2px #D6D6D6;'>\
<td style='border: solid 2px #D6D6D6;background: #EEEEEE;text-align: center;padding-top: 15px;padding-bottom: 15px;font-family: SourceHanSansCN-Medium;\
font-size: 16px;\
color: #666666;'>神经层</td>\
<td style='border: solid 2px #D6D6D6;background: #EEEEEE;text-align: center;padding-top: 15px;padding-bottom: 15px;font-family: SourceHanSansCN-Medium;\
font-size: 16px;\
color: #666666;'>参数缩放系数</td>\
</tr>";
                document.getElementById("model_convert_progress_div").style.width = "0%";
                document.getElementById("preprocess_progress_div").style.width = "0%";
                document.getElementById("search_progress_div").style.width = "0%";
                document.getElementById("darlang_progress_div").style.width = "0%";

                document.getElementById("model_convert_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>"+Math.min(parseInt(document.getElementById("model_convert_progress_div").style.width.replace("%", "")), 100)+"%</div>";
                document.getElementById("preprocess_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>"+Math.min(parseInt(document.getElementById("preprocess_progress_div").style.width.replace("%", "")), 100)+"%</div>";
                document.getElementById("search_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>"+Math.min(parseInt(document.getElementById("search_progress_div").style.width.replace("%", "")), 100)+"%</div>";
                document.getElementById("darlang_progress_div").innerHTML = "<div style='color: #333;font-size:20px;padding-top:10px;'>"+Math.min(parseInt(document.getElementById("darlang_progress_div").style.width.replace("%", "")), 100)+"%</div>";

                log_output_lists.splice(0);
                stage1_convert_finish = false;
                stage2_preprocess_finish = false;
                stage3_search_finish = false;
                stage4_all_finish = false;
                $(".loading-div").show();

                // $("#error_msg_div").text(data.exec_error);
                // $("#exec_error_modal_btn").click();
                $("#error_detail").html("<strong>转换代码执行错误！</strong><br/>错误信息：<br/>"+data.exec_error);
                $("#alert_modal_btn").click();
                document.getElementById("total_progress_ball").style.display = "none";
              } else if (data.show_error)  {
                $("#error_detail").text(data.show_error);
                if (data.show_stop_compile) {
                    $("#stp_compile_btn").css("display", "inline-block");
                    $("#error_dialog_close_btn").css("margin-left", "60px");
                } else {
                    $("#stp_compile_btn").css("display", "none");
                    $("#error_dialog_close_btn").css("margin-left", "180px");
                }
                $("#alert_modal_btn").click();
              } else if (data.preset_param) {
                  console.log("转换界面接收到预设参数.....");
                  if (data.vthresh) {
                      console.log("设置预设参数：vthresh="+data.vthresh);
                    $("#select_vthresh").val(data.vthresh);
                  }
              } else if (data.progress_stub) {
                  console.log("转换界面接收到log fin stub..... s1="+data.s1_fin_stub+", s2="+data.s2_fin_stub+", s3="+data.s3_fin_stub+", s4="+data.s4_fin_stub);
                  s1_fin_stub = parseInt(data.s1_fin_stub);
                  s2_fin_stub = parseInt(data.s2_fin_stub);
                  s3_fin_stub = parseInt(data.s3_fin_stub);
                  s4_fin_stub = parseInt(data.s4_fin_stub);
              } else if (data.start_compile_binary) {
                  $("#rnm_binary_btn").click();

              }
          });


          // 参数更改监听
          $("#select_vthresh").change(()=>{
            console.log("参数变动...");
            reset_and_postmsg();
          });
          $("#select_dt").change(()=>{
              console.log("参数变动...");
              reset_and_postmsg();
          });
          $("#select_synapse_dt").change(()=>{
              console.log("参数变动...");
              reset_and_postmsg();
          });
          $("#select_delay").change(()=>{
              console.log("参数变动...");
              reset_and_postmsg();
          });
          $("#select_dura").change(()=>{
              console.log("参数变动...");
              reset_and_postmsg();
          });
        //   $("#start_convert_btn").on("click", ()=>{
        //       let v_thresh = $("#select_vthresh").val().replace("ms","");
        //       let neuron_dt = $("#select_dt").val().replace("ms","");
        //       let synapse_dt = $("#select_synapse_dt").val().replace("ms","");
        //       let delay = $("#select_delay").val().replace("ms", "");
        //       let dura = $("#select_dura").val().replace("ms","");
        //       document.getElementById("start_convert_btn").style.backgroundColor = "chocolate";
        //       console.log("v_thresh="+v_thresh+", neuron_dt="+neuron_dt+", synapse_dt="+synapse_dt+", delay="+delay);
        //       vscode.postMessage(JSON.stringify({"model_convert_params":{
        //           "vthresh": v_thresh,
        //           "neuron_dt": neuron_dt,
        //           "synapse_dt":synapse_dt,
        //           "delay":delay,
        //           "dura":dura
        //       }}));
        //       document.getElementById("model_convert_progress_div").style.width = "0%";
        //       document.getElementById("preprocess_progress_div").style.width = "0%";
        //       document.getElementById("search_progress_div").style.width = "0%";
        //       document.getElementById("darlang_progress_div").style.width = "0%";
        //       document.getElementById("total_progress_div").style.width = "0%";

        //   });

      });

      function reset_and_postmsg(){
            let v_thresh = $("#select_vthresh").val().replace("ms","");
            let neuron_dt = $("#select_dt").val().replace("ms","");
            // let synapse_dt = $("#select_synapse_dt").val().replace("ms","");
            let synapse_dt = neuron_dt;
            let delay = $("#select_delay").val().replace("ms", "");
            let dura = $("#select_dura").val().replace("ms","");
            console.log("v_thresh="+v_thresh+", neuron_dt="+neuron_dt+", synapse_dt="+synapse_dt+", delay="+delay+", dura="+dura);
            log_output_lists.splice(0);
            stage1_convert_finish = false;
            stage2_preprocess_finish = false;
            stage3_search_finish = false;
            stage4_all_finish = false;
            // // 传递到插件
            // vscode.postMessage(JSON.stringify({"convertor_params_change":{
            //     "v_thresh":v_thresh,
            //     "neuron_dt":neuron_dt,
            //     "synapse_dt":synapse_dt,
            //     "delay":delay,
            //     "dura":dura
            // }}));
              document.getElementById("model_convert_progress_div").style.width = "0%";
              document.getElementById("preprocess_progress_div").style.width = "0%";
              document.getElementById("search_progress_div").style.width = "0%";
              document.getElementById("darlang_progress_div").style.width = "0%";
            //   document.getElementById("total_progress_div").style.width = "0%";
      }


    //   function display_spike_scatter_chart(labels, datas){
    //       var opt={
    //             xAxis: {
    //                 type:'category',
    //                 data: labels
    //             },
    //             yAxis: {
    //                 splitLine:{show:false},
    //                 axisLine: {show: false}, 
    //                 axisTick: {show: false},
    //                 axisLabel:{show:false}
    //             },
    //             series: [{
    //                 symbolSize: 5,
    //                 data: datas,
    //                 type: 'scatter'
    //             }]
    //         };
    //         var spike_chart = echarts.init(document.getElementById("spike_charts"));
    //         spike_chart.setOption(opt);
    //   }


      function display_bar_chart(label_names, label_counts, title,series_name,target_id){
        console.log("label names:"+label_names);
        console.log("label counts:"+label_counts);
        var option = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    crossStyle: {
                        color: '#999'
                    }
                }
            },
            xAxis: [
                {
                    type: 'category',
                    data:label_names,
                    axisPointer: {
                        type: 'shadow'
                    },
                    axisLabel:{
                        rotate:30,
                        color:"#999999"
                    }
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    name: '时长(秒)',
                    nameTextStyle:{
                        color:"#999999"
                    },
                    scale:true,
                    axisLabel: {
                        formatter: '{value}',
                        textStyle:{
                            color:"#999999"
                        }
                    }
                }
            ],
            series: [
                {
                    name: series_name,
                    type: 'bar',
                    data: label_counts,
                    barWidth:"30px",
                    itemStyle: {
                        normal: {
                            label: {
                                show: true, //开启显示
                                position: 'top', //在上方显示
                                textStyle: { //数值样式
                                    color:"#999999",
                                    fontSize: 16
                                }
                            },
                            color: new echarts.graphic.LinearGradient(
                              0, 0, 0, 1,
                            [
                                {offset: 0, color: '#77A4FF'},   
                                {offset: 1, color: '#A5CBFF'}
                            ]
                            )
                        },
                        emphasis: {
                          color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                              [
                                {offset: 0, color: '#2FDECA'},
                                {offset: 1, color: '#2FDE80'}
                              ]
                          )
                        }
                    }
                }
            ]
        };
        var bar_chart_data = echarts.init(document.getElementById(target_id));
        bar_chart_data.setOption(option);
    }
</script>

</html>