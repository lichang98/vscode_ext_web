<!DOCTYPE html>
<html style="height: 100%;width: 100%;">

<head>
  <meta charset="UTF-8">
  <title>模型转换器</title>
</head>
<body class="dark-mode" style="height: 100%;width: 100%;overflow: auto;">
    <!-- 左侧导航栏 主面板与配置面板 -->
    <div class="row" style="height: 100%;width: 100%;">
      <!-- 加载提示 -->
      <div id="loader_tip" class="preloader-wrapper big active" style="position: absolute;margin-left: 600px;margin-top: 100px;display: none;">
        <div class="spinner-layer spinner-green-only">
          <div class="circle-clipper left">
            <div class="circle"></div>
          </div><div class="gap-patch">
            <div class="circle"></div>
          </div><div class="circle-clipper right">
            <div class="circle"></div>
          </div>
        </div>
      </div>
      <div class="loading-div">
        <i class="fa fa-spinner fa-pulse fa-3x fa-fw" style="display: block;margin-left: 50vw;"></i>
        <span style="color: #333;height: 50px;width: 120px;margin-left: calc(50vw - 20px);display: block;"><font style="color: #333;font-weight: bolder;">模型信息加载中...</font></span>
      </div>

      <!--展示的主面板-->
      <div class="row" style="height: 45%;width: 100%;">
          <div class="col-md-6" style="background: rgba(238,238,238,0.4);height: 345px;">
            <!-- 数据基本信息表格 -->
            <table id="data_general_table" style="width:440px; margin-left:100px;color: #333;">
              <caption class="white-text" style="caption-side: top;font-weight: bold;text-align: center;font-size: large;"><font style="color: #333;">导入数据统计</font></caption>
              <tr style="border: solid 3px;height: 40px;">
                <td style="font-size: medium;font-weight: bold;padding-left: 15px;background: rgb(238,238,238);border: solid 2px;">总数据大小</td>
                <td id="total_data_amount" style="font-weight:bolder;padding-left: 10px;"></td>
              </tr>
              <tr style="border: solid 3px;height: 40px;">
                <td style="font-size: medium;font-weight: bold;padding-left: 15px;background: rgb(238,238,238);border: solid 2px;">测试数据量</td>
                <td id="test_data_amount" style="font-weight: bolder;padding-left: 10px;"></td>
              </tr>
              <tr style="border: solid 3px;height: 40px;">
                <td style="font-size: medium;font-weight: bold;padding-left: 15px;background: rgb(238,238,238);border: solid 2px;">验证数据量</td>
                <td id="val_data_amount" style="font-weight: bolder;padding-left: 10px;"></td>
              </tr>
              <tr style="border: solid 3px;height: 40px;">
                <td style="font-size: medium;font-weight: bold;padding-left: 15px;background: rgb(238,238,238);border: solid 2px;">数据类别个数</td>
                <td id="class_counts" style="font-weight: bolder;padding-left: 10px;"></td>
              </tr>
            </table>
          </div>
          <div class="col-md-6" style="background: rgba(238,238,238,0.4);height: 345px;">
            <div style="text-align: center;font-weight: bold;font-size: large;margin-bottom:20px;color: #333;">
              数据类别分布
            </div>
            <div id="bar_chart_testdata_container" style="width: 440px;height: 300px;margin-left:100px;"></div>
          </div>
      </div>
      <div class="row" style="height: 45%;width: 100%;margin-top:35px;">
        <div id="sample_data_div" class="col-md-6" style="height:351px;background: rgba(238,238,238,0.4);">
          <div style="text-align: center;font-weight: bold;font-size: large;margin-left:15px;color: black;">
            训练集样例数据
          </div>
          <ul id="sample_imgs_ul" style="height: 300px;width: 100px;overflow: auto;display: inline-block;background: rgb(238,238,238);">
            <li id="sample_img0_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img0" onclick="sample_img_click(this);" src="${sample0}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="sample_img1_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img1" onclick="sample_img_click(this);" src="${sample1}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="sample_img2_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img2" onclick="sample_img_click(this);" src="${sample2}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="sample_img3_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img3" onclick="sample_img_click(this);" src="${sample3}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="sample_img4_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img4" onclick="sample_img_click(this);" src="${sample4}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="sample_img5_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img5" onclick="sample_img_click(this);" src="${sample5}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="sample_img6_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img6" onclick="sample_img_click(this);" src="${sample6}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="sample_img7_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img7" onclick="sample_img_click(this);" src="${sample7}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="sample_img8_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img8" onclick="sample_img_click(this);" src="${sample8}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="sample_img9_li" style="list-style: none;margin-bottom: 10px;">
              <img id="sample_img9" onclick="sample_img_click(this);" src="${sample9}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
          </ul>
          <div id="bar_chart_histgram" style="width: 440px;height: 320px;margin-top: 0px;display: inline-block;"></div>
        </div>
        <div id="sample_testdataset_data_div" class="col-md-6" style="height: 351px;background: rgba(238,238,238,0.4);">
          <div style="text-align: center;font-weight: bold;font-size: large;margin-left:15px;color: black;">
            测试集样例数据
          </div>
          <ul id="test_sample_imgs_ul" style="height: 300px;width: 100px;overflow: auto;display: inline-block;">
            <li id="test_sample_img0_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img0" onclick="sample_img_click(this);" src="${test_sample0}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="test_sample_img1_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img1" onclick="sample_img_click(this);" src="${test_sample1}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="test_sample_img2_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img2" onclick="sample_img_click(this);" src="${test_sample2}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="test_sample_img3_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img3" onclick="sample_img_click(this);" src="${test_sample3}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="test_sample_img4_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img4" onclick="sample_img_click(this);" src="${test_sample4}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="test_sample_img5_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img5" onclick="sample_img_click(this);" src="${test_sample5}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="test_sample_img6_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img6" onclick="sample_img_click(this);" src="${test_sample6}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="test_sample_img7_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img7" onclick="sample_img_click(this);" src="${test_sample7}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="test_sample_img8_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img8" onclick="sample_img_click(this);" src="${test_sample8}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
            <li id="test_sample_img9_li" style="list-style: none;margin-bottom: 10px;">
              <img id="test_sample_img9" onclick="sample_img_click(this);" src="${test_sample9}" style="width: 50px;height: 50px;margin-left: 20px;">
            </li>
          </ul>
          <div id="test_bar_chart_histgram" style="width: 440px;height: 320px;margin-top: 0px;display: inline-block;"></div>
        </div>
      </div>
    </div>
</body>
<style>

.editor-sidenav{
  background-color: #333;
}

body {
  padding: 25px;
  background-color: rgb(251, 255, 255);
  color: white;
  font-size: 25px;
}

.dark-mode {
  background-color: rgb(249, 251, 252);
  color: white;
}
  @font-face {
    font-family: 'Material Icons';
    font-style: normal;
    font-weight: 400;
    src: local('Material Icons'), local('MaterialIcons-Regular'), url(https://fonts.gstatic.com/s/materialicons/v7/2fcrYFNaTjcS6g4U3t-Y5ZjZjT5FdEJ140U2DJYC3mY.woff2) format('woff2');
  }

  .material-icons {
    font-family: 'Material Icons';
    font-weight: normal;
    font-style: normal;
    font-size: 24px;
    line-height: 1;
    text-transform: none;
    display: inline-block;
    -webkit-font-feature-settings: 'liga';
    -webkit-font-smoothing: antialiased;
  }

  .resizable {
    resize: both;
    overflow: scroll;
    border: 1px solid rgb(0, 0, 0);
  }
  .dropdown-content{
   width: max-content !important;
   height:auto !important;
}

.loading-div {
      width: 1800px;
      height: 720px;
      display: table-cell;
      vertical-align: middle;
      color: #555;
      overflow: hidden;
      text-align: center;
    }
.loading-div::before {
  display: inline-block;
  vertical-align: middle;
} 
</style>
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.0.1/echarts.min.js" integrity="sha512-vMD/IRB4/cFDdU2MrTwKXOLmIJ1ULs18mzmMIWLCNYg/nZZkCdjBX+UPrtQdkleuuf0YaqXssaKk8ZXOpHo3qg==" crossorigin="anonymous"></script> -->

<link rel="stylesheet" href="http://localhost:6003/css/materialize.min.css">
<link rel="stylesheet" href="http://localhost:6003/css/bootstrap.min.css" >
<link rel="stylesheet" href="http://localhost:6003/css/font-awesome.min.css">

<script src="http://localhost:6003/js/jquery.min.js"></script>
<script src="http://localhost:6003/js/materialize.min.js"></script>
<script src="http://localhost:6003/js/bootstrap.min.js"></script>
<script src="http://localhost:6003/js/echarts.min.js"></script>

<script>
var prev_click_img_li_id = undefined;
var prev_click_img_li_test_id = undefined;
var data_info=undefined;
$(document).ready(function(){
  // display_data_bar_chart(['0','1','2','3','4','5','6','7','8','9'],
  //       [0.098,0.1135,0.1032,0.101,0.0982,0.0892,0.0958,0.1028,0.0974,0.1009],"训练数据集各类别分布", "数据占比","pie_chart_container");
  // display_data_bar_chart(["0-28","28-56","56-85","85-113","113-141","141-170","170-198","198-226","226-255"],
  //         [639,8,7,1,19,18,8,9,79,0],"像素分布","该范围内像素点个数","bar_chart_histgram");
  // display_data_bar_chart(['0','1','2','3','4','5','6','7','8','9'],
  //   [0.098,0.101,0.1028,0.0974,0.1009,0.1135,0.0982,0.0892,0.0958,0.1032],"测试数据集各类别分布","数据占比","bar_chart_testdata_container")
    window.addEventListener("message", (event)=>{
      const data = JSON.parse(event.data);
      data_info = data
      console.log("data vis webview receive data: "+data);
      $("#total_data_amount").text(data.total_data_count);
      $("#test_data_amount").text(data.norm_data_count);
      $("#val_data_amount").text(data.test_data_count);
      $("#class_counts").text(data.num_classes);
      var sample_count = data.sample_imgs.length;
      if(sample_count < 10){
        for(var i=0;i<10-sample_count;++i){
          $("#sample_img"+(10-i-1)).remove();
        }
      }
      for(var i=0;i<sample_count;++i){
        $("#sample_img"+i).hide();
        $("#sample_img"+i).show();
      }
      var class_labels = new Array();
      var class_ratios = new Array();
      var class_total_count = 0;
      console.log("cls_counts="+data.cls_counts);
      console.log("num_class="+data.num_classes);
      for(var i=0;i<data.cls_counts.length;++i){
        class_total_count += data.cls_counts[i];
      }
      for(var i=0;i<data.cls_counts.length;++i){
        class_ratios.push(data.cls_counts[i]/class_total_count);
      }
      for(var i=0;i<data.num_classes;++i){
        class_labels.push(""+i);
      }
      // 对数处理histgram
      for(var i=0;i<data_info.test_sample_imgs.length;++i){
        for(var j=0;j<data_info.test_sample_imgs[i].hist_gram_bins.length;++j){
          if(data_info.test_sample_imgs[i].hist_gram_bins[j] > 0){
            data_info.test_sample_imgs[i].hist_gram_bins[j] = Math.log10(data_info.test_sample_imgs[i].hist_gram_bins[j]);
          }
        }
      }

      for(var i=0;i<data_info.sample_imgs.length;++i){
        for(var j=0;j<data_info.sample_imgs[i].hist_gram_bins.length;++j){
          if(data_info.sample_imgs[i].hist_gram_bins[j] > 0){
            data_info.sample_imgs[i].hist_gram_bins[j] = Math.log10(data_info.sample_imgs[i].hist_gram_bins[j]);
          }
        }
      }

      $(".loading-div").hide(); // 隐藏加载提示
      console.log("display test data distribution...");
      display_data_bar_chart(class_labels, class_ratios, "测试数据集各类别分布",  "数据占比","类别", "占比", "bar_chart_testdata_container");
      console.log("test data distribution bar chart displayed.");
  });
});

function sample_img_click(e){
  var sampleId = $(e).attr("id");
  if(sampleId.substring(0,4) === "test"){
    if(prev_click_img_li_test_id !== undefined){
      document.getElementById(prev_click_img_li_test_id).style.backgroundColor="";
      document.getElementById(prev_click_img_li_test_id).style.opacity = "";
    }
    prev_click_img_li_test_id = sampleId+"_li";
    document.getElementById(prev_click_img_li_test_id).style.backgroundColor = "#00868B";
    document.getElementById(prev_click_img_li_test_id).style.opacity = "0.5";
  }else{
    if(prev_click_img_li_id !== undefined){
      document.getElementById(prev_click_img_li_id).style.backgroundColor = "";
      document.getElementById(prev_click_img_li_id).style.opacity = "";
    }
    prev_click_img_li_id = sampleId+"_li";
    document.getElementById(prev_click_img_li_id).style.backgroundColor = "#00868B";
    document.getElementById(prev_click_img_li_id).style.opacity = "0.5";
  }
  console.log("current click img id="+sampleId);
  var sampleIdx = parseInt(sampleId.substring(sampleId.length-1));
  if(sampleId.substring(0,4) === "test"){
    display_data_bar_chart(data_info.hist_bin_names, data_info.test_sample_imgs[sampleIdx].hist_gram_bins, "像素分布", "像素灰度值分布","区间","数量(log_10)", "test_bar_chart_histgram");
  }else{
    display_data_bar_chart(data_info.hist_bin_names, data_info.sample_imgs[sampleIdx].hist_gram_bins, "像素分布", "像素灰度值分布","区间","数量(log_10)", "bar_chart_histgram");
  }
}



    function display_data_bar_chart(label_names, label_counts, title,series_name,x_axis_name, y_axis_name,target_id){
      console.log("label names:"+label_names);
      console.log("label counts:"+label_counts);
      var option = {
            tooltip:{
                trigger:"axis"
              },
            xAxis: {
              type: 'category',
                  data: label_names,
                  scale:true,
                  name:x_axis_name,
                  nameTextStyle:{
                    color:"black"
                  },
                  axisLabel:{
                    textStyle:{
                      color:"black"
                    }
                  }
            },
            yAxis: [
                {
                  type: 'value',
                  scale:true,
                  name:y_axis_name,
                  nameTextStyle:{
                    color:"black"
                  },
                  axisLabel:{
                    textStyle:{
                      color:"black"
                    }
                  }
                },
                {
                  type: 'value',
                  scale:true,
                  name:"",
                  show:false,
                  nameTextStyle:{
                    color:"white"
                  },
                  axisLabel:{
                    show:false,
                    textStyle:{
                      color:"white"
                    }
                  }
                }
            ],
            series: [
                {
                    name: series_name,
                    type: 'bar',
                    data: label_counts,
                    itemStyle: {
                      normal: {
                        color: new echarts.graphic.LinearGradient(
                              0, 0, 0, 1,
                            [
                                {offset: 0, color: '#BBFFFF'},   
                                {offset: 1, color: '#2FDECA'}
                            ]
                            )
                        },
                        emphasis: {
                          color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                              [
                                {offset: 0, color: '#2FDECA'},
                                {offset: 1, color: '#2FDE80'}
                              ]
                          )
                        }
                    }
                },
                {
                    name: series_name,
                    type: 'line',
                    yAxisIndex: 1,
                    data: label_counts,
                    itemStyle:{
                        normal:{
                            lineStyle:{
                                color:"#FF994B"
                            }
                        }
                    }
                }
            ]
        };
        var bar_chart_data = echarts.init(document.getElementById(target_id));
        bar_chart_data.setOption(option);
    }
</script>